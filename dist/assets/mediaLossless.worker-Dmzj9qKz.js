var k=Object.defineProperty;var b=a=>{throw TypeError(a)};var C=(a,e,t)=>e in a?k(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var E=(a,e,t)=>C(a,typeof e!="symbol"?e+"":e,t),S=(a,e,t)=>e.has(a)||b("Cannot "+t);var s=(a,e,t)=>(S(a,e,"read from private field"),t?t.call(a):e.get(a)),R=(a,e,t)=>e.has(a)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),L=(a,e,t,i)=>(S(a,e,"write to private field"),i?i.call(a,t):e.set(a,t),t);var r;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.FFPROBE="FFPROBE",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(r||(r={}));const T=(()=>{let a=0;return()=>a++})(),v=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),y=new Error("called FFmpeg.terminate()");var m,h,l,p,D,_,f;class M{constructor(){R(this,m,null);R(this,h,{});R(this,l,{});R(this,p,[]);R(this,D,[]);E(this,"loaded",!1);R(this,_,()=>{s(this,m)&&(s(this,m).onmessage=({data:{id:e,type:t,data:i}})=>{switch(t){case r.LOAD:this.loaded=!0,s(this,h)[e](i);break;case r.MOUNT:case r.UNMOUNT:case r.EXEC:case r.FFPROBE:case r.WRITE_FILE:case r.READ_FILE:case r.DELETE_FILE:case r.RENAME:case r.CREATE_DIR:case r.LIST_DIR:case r.DELETE_DIR:s(this,h)[e](i);break;case r.LOG:s(this,p).forEach(c=>c(i));break;case r.PROGRESS:s(this,D).forEach(c=>c(i));break;case r.ERROR:s(this,l)[e](i);break}delete s(this,h)[e],delete s(this,l)[e]})});R(this,f,({type:e,data:t},i=[],c)=>s(this,m)?new Promise((o,n)=>{const d=T();s(this,m)&&s(this,m).postMessage({id:d,type:e,data:t},i),s(this,h)[d]=o,s(this,l)[d]=n,c==null||c.addEventListener("abort",()=>{n(new DOMException(`Message # ${d} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(v));E(this,"load",({classWorkerURL:e,...t}={},{signal:i}={})=>(s(this,m)||(L(this,m,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-DYSz7Krg.js",import.meta.url),{type:"module"})),s(this,_).call(this)),s(this,f).call(this,{type:r.LOAD,data:t},void 0,i)));E(this,"exec",(e,t=-1,{signal:i}={})=>s(this,f).call(this,{type:r.EXEC,data:{args:e,timeout:t}},void 0,i));E(this,"ffprobe",(e,t=-1,{signal:i}={})=>s(this,f).call(this,{type:r.FFPROBE,data:{args:e,timeout:t}},void 0,i));E(this,"terminate",()=>{const e=Object.keys(s(this,l));for(const t of e)s(this,l)[t](y),delete s(this,l)[t],delete s(this,h)[t];s(this,m)&&(s(this,m).terminate(),L(this,m,null),this.loaded=!1)});E(this,"writeFile",(e,t,{signal:i}={})=>{const c=[];return t instanceof Uint8Array&&c.push(t.buffer),s(this,f).call(this,{type:r.WRITE_FILE,data:{path:e,data:t}},c,i)});E(this,"mount",(e,t,i)=>{const c=[];return s(this,f).call(this,{type:r.MOUNT,data:{fsType:e,options:t,mountPoint:i}},c)});E(this,"unmount",e=>{const t=[];return s(this,f).call(this,{type:r.UNMOUNT,data:{mountPoint:e}},t)});E(this,"readFile",(e,t="binary",{signal:i}={})=>s(this,f).call(this,{type:r.READ_FILE,data:{path:e,encoding:t}},void 0,i));E(this,"deleteFile",(e,{signal:t}={})=>s(this,f).call(this,{type:r.DELETE_FILE,data:{path:e}},void 0,t));E(this,"rename",(e,t,{signal:i}={})=>s(this,f).call(this,{type:r.RENAME,data:{oldPath:e,newPath:t}},void 0,i));E(this,"createDir",(e,{signal:t}={})=>s(this,f).call(this,{type:r.CREATE_DIR,data:{path:e}},void 0,t));E(this,"listDir",(e,{signal:t}={})=>s(this,f).call(this,{type:r.LIST_DIR,data:{path:e}},void 0,t));E(this,"deleteDir",(e,{signal:t}={})=>s(this,f).call(this,{type:r.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?s(this,p).push(t):e==="progress"&&s(this,D).push(t)}off(e,t){e==="log"?L(this,p,s(this,p).filter(i=>i!==t)):e==="progress"&&L(this,D,s(this,D).filter(i=>i!==t))}}m=new WeakMap,h=new WeakMap,l=new WeakMap,p=new WeakMap,D=new WeakMap,_=new WeakMap,f=new WeakMap;var U;(function(a){a.MEMFS="MEMFS",a.NODEFS="NODEFS",a.NODERAWFS="NODERAWFS",a.IDBFS="IDBFS",a.WORKERFS="WORKERFS",a.PROXYFS="PROXYFS"})(U||(U={}));function N(a){var i;const e="/".replace(/\/+$/,"/"),t=((i=self.location)==null?void 0:i.origin)||"";return new URL(e+a.replace(/^\/+/,""),t).toString()}const O=new M;let g=!1;async function P(){g||(await O.load({coreURL:N("ffmpeg/ffmpeg-core.js"),wasmURL:N("ffmpeg/ffmpeg-core.wasm"),workerURL:N("ffmpeg/ffmpeg-worker.js")}),g=!0)}function w(a,e){return a.replace(/\.[^.]+$/,"")+e}function I(a,e){const t=a.toLowerCase();return t===".mp4"?"video/mp4":t===".mkv"?"video/x-matroska":t===".webm"?"video/webm":t===".flac"?"audio/flac":e}self.onmessage=async a=>{const{id:e,name:t,type:i,arrayBuffer:c}=a.data;try{await P();const o=t;await O.writeFile(o,new Uint8Array(c));let n=t,d=i,u=[];if(i.startsWith("video/"))o.toLowerCase().endsWith(".mp4")?(n=w(o,".mp4"),d=I(".mp4",i),u=["-i",o,"-map","0","-map_metadata","-1","-c","copy","-movflags","+faststart",n]):o.toLowerCase().endsWith(".mkv")?(n=w(o,".mkv"),d=I(".mkv",i),u=["-i",o,"-map","0","-map_metadata","-1","-c","copy",n]):o.toLowerCase().endsWith(".webm")?(n=w(o,".webm"),d=I(".webm",i),u=["-i",o,"-map","0","-map_metadata","-1","-c","copy",n]):(n=o,d=i,u=["-i",o,"-map","0","-map_metadata","-1","-c","copy",n]);else if(i.startsWith("audio/"))o.toLowerCase().endsWith(".wav")?(n=w(o,".flac"),d=I(".flac",i),u=["-i",o,"-map_metadata","-1","-c:a","flac",n]):(n=o,d=i,u=["-i",o,"-map","0","-map_metadata","-1","-c","copy",n]);else{postMessage({id:e,passThrough:!0});return}await O.exec(u);const W=await O.readFile(n),A=new Blob([W],{type:d});postMessage({id:e,outName:n,outType:d,outSize:A.size,blob:A})}catch(o){postMessage({id:e,error:(o==null?void 0:o.message)||"Media optimization failed"})}finally{try{await O.deleteFile(t)}catch{}}};
